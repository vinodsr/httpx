<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.0/socket.io.slim.js"></script>
    <script src="https://code.jquery.com/jquery.js"></script>
    <script>
        // Wrappers
        const eventHooks = {};
        class http {
            static send(request, sucess, error) {
                request.headers = {
                    "clientID": socket.id
                }
                $.ajax(request).done((data) => {
                    // Check if this is a event to hook ?
                    if (typeof data._event === "object") // TODO : Replace the check 
                    {
                        // Handle the lookup
                        eventHooks[data._event.id] = sucess;
                    } else {
                        sucess(data)
                    }
                }).fail(error);
            }
        }

        var socket = io("http://localhost:3001");
        console.log(socket)
        socket.on("message", function (data) {
            console.log(data);
            eventHooks[data._event.eventid](data)
        })

    </script>
</head>

<body>
    Dashboard
    <div>
        Time :
        <span id="time"></span>
    </div>
    <div>
        Time2 :
        <span id="time2"></span>
    </div>
    <div>
        <button id="timebtn">Get Time</button>
        <button id="timebtn2">Get Time2</button>
        <button id="clearbtn">Clear</button>
    </div>
    <div id="console"></div>
    <script>

        $("#clearbtn").click(() => {
            $("#console").html("");
        })
        function log(msg) {
            $("#console").append(msg + "<br/>");
        }
        $("#timebtn").click(() => {
            log("trigger - get time ()")
            http.send({
                url: "/time/real"
            }, function sucess(data) {
                $("#time").html(data.time);
            }, function error(err) {
                console.log("Error occured while calling time/real", err)

            });
        });

        $("#timebtn2").click(() => {
            log("trigger - get time 2 ()")
            http.send({
                url: "/time/real"
            }, function sucess(data) {
                $("#time2").html(data.time);
            }, function error(err) {
                console.log("Error occured while calling time/real", err)

            });
        });


    </script>
</body>

</html>